# Changelog

## Version 3.2.0

### Feature

- Add module::find_instance_component() to find a distinct TYPEDEF_* referenced by an instance based on a full name.

### Bugfixes

- The data type members of of FIX_AXIS_PAR and FIX_AXIS_PAR_DIST was changed to float in A2L version 1.7
- Cross-references to elements of INSTANCEs are handled correctly during consistency checks

## Version 3.1.1

### Bugfix

- The new functions import_new() and import_all() did not handle a2ml

## Version 3.1.0

### Features

- Add additional ways of merging a2l modules
  - Module::import_new(): add new items from a module, discarding any with conflicting names
  - Module::import_all(): import allitems from a module, overwriting any existing ones with conflicting names
- Add additional consistency checks
  - COMPU_METHOD must have the correct sub elements depending on the type, e.g. COMPU_TAB_REF for type TAB_VERB
  - AXIS_DESCR sub elements are also different for each type

## Version 3.0.0

### Features

- Named objects are now stored in "ItemLists" which are similar to IndexMaps.
  This means that the objects can be looked up by index and by name.
  This change is likely to break some code.
- Comments are now preserved in some cases. Specifically, any comment that occurs in a
  position where a block is permitted can be can be represented in the data, and is written to the output file.
  Sorting a2l files erases comments.
- Checker: Add the ability to refer to a TYPEDEF_AXIS using THIS
  A cross reference using THIS is now handled correctly.
- Individual features of a2lfile can be enabled or disabled in cargo.toml using crate features
  - [check]: check the plausibility of the data in the a2l file
  - [cleanup]: remove unused items in the file
  - [ifdata_cleanup]: remove incorrect IF_DATA
  - [merge]: merge the content of two MODULEs
  - [sort]: sort the content of the a2l file
  All features are active by default.

### A2L data

- The values of BIT_MASK and error mask are u64 instead of u32, and parsing no longer fails for values that don't fit in u32.
- Allow multiple CALIBRATION_HANDLEs inside of CALIBRATION_METHOD (Rainer Zaiser)
- Parsing of VAR_CRITERION has been fixed, so that the optional keywords VAR_MEASUREMENT and
  VAR_SELECTION_CHARACTERISTIC can be recognized.

### API changes

- NameMap was removed, since it is no longer needed.
- Previously deprecated load_fragment / load_frament_file functions were removed.
  The replacement functions have been renamed:
  load_fragment2 -> load_fragment
  load_fragment_file2 -> load_fragment_file
- the check() function provides detailed error info in its return value (Vec of A2lError)
  instead of extending a list of Strings. This allows the caller to inspect the errors
  without parsing the strings.

## Version 2.4.0

- OS independen path separator handling in /include (Akhil T Thomas)
- Add the APIs load_fragment2 and load_fragment_file2, deprecating the old versions
- a2l checker improvements
  - The RECORD_LAYOUT used by a CHARACTERISTIC must contain FNC_VALUES
  - A RECORD_LAYOUT must contain an AXIS_PTS_X/Y/Z for each internal axis
  - There should be a specific number of AXIS_DESCR depending on the type of RECORD_LAYOUT
  - The lower and upper limits of CHARACTERISTICs, MEASUREMENTs and AXIS_PTS
    are checked for plausibility based on the data type of the item and its COMPU_METHOD.

## Version 2.3.2

- fix incorrect handling of escape codes \r, \n, \t while writing files

## Version 2.3.1

- fix the newly added input quantity check in AXIS_PTS: NO_INPUT_QUANTITY must be handled explicitly

## Version 2.3.0

- change the behavior of merge for GROUPS and FUNCTION
  Previously, if two GROUPS in a merge had the same name, then the incoming group was renamed with the suffix ".MERGE".
  Now the content for GROUPs/FUNCTIONs with the same name is combined.
- a2l checker improvements
  - fix incorrect checks for TYPEDEF_AXIS and COMPU_METHOD
  - add extra checks for GROUP, MEASUREMENT, COMPU_METHOD, AXIS_PTS
  - add tests for all the checks

## Version 2.2.0

- allow the parser to read hex encoded integers where a float is expected (Louis Caron)
- generate Rust enums with values for A2ML enums with values in the a2ml_specification macro
- fix some cases where users of items that were renamed during a merge were not updated to use the new name

## Version 2.1.0

- add handling of /include inside A2ML blocks (Louis Caron)
- fix multi-level /include inside A2L (bug report by Louis Caron)

## Version 2.0.0

- Specification: AR_COMPONENT is a block enclosed in /begin and /end, not a keyword
- Specification: The integer value in a STRUCTURE_COMPONENT should be called "address_offset" instead of "size"
- Specification: The proc macro specification has been replaced with the code generated by the macro.
  This provides no direct benefit, but allows rust-analyzer to understand all of a2lfile.
- Cleanup: References from TYPEDEF_AXIS to RECORD_LAYOUT are now taken into account, so that used RECORD_LAYOUTs are not removed
- Cleanup: References from STATUS_STRING_REF to COMPU_METHOD are now taken into account, so that used COMPU_METHODs are not removed
- Documentation: The type of log_msgs is now correctly shown als A2lError instead of String
- Misc: Improved tests
- Misc: Updated github workflows
- Misc: Apache2 and MIT license files were added to the repository
